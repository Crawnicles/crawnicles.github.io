<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Post • Andrew Crawford</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0d0f12; --ink:#eef2f6; --muted:#a8b3bd; --ring:#2a2f36; --card:#151a20e6 }
    body{margin:0; background:var(--bg); color:var(--ink); font-family:Inter, system-ui; line-height:1.65}
    .wrap{max-width:820px; margin:0 auto; padding:2rem 1rem}
    .card{background:var(--card); border:1px solid var(--ring); border-radius:16px; padding:1.2rem}
    a{color:inherit}
    #title{font-family:"Noto Serif JP", serif; font-size:clamp(1.6rem,3.4vw,2.2rem); margin:.2rem 0 1rem}
    #meta{color:var(--muted); margin-bottom:1rem}
    #content h2,#content h3{font-family:"Noto Serif JP", serif}
    #content img{max-width:100%; border-radius:10px; border:1px solid var(--ring)}
    .back{display:inline-flex; gap:.5rem; align-items:center; margin-bottom:1rem; text-decoration:none;}
    .back span{border:1px solid var(--ring); border-radius:999px; padding:.2rem .6rem; background:#111a;}
  </style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="./"><span>⟵</span> Back to site</a>
    <div class="card">
      <div id="title">Loading…</div>
      <div id="meta"></div>
      <div id="content">Please hold…</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const src = params.get('src'); // e.g. writings/hello-world.md
    const t   = params.get('title') || '';
    if (t) document.getElementById('title').textContent = t;

    function fmtDate(d){ return new Date(d).toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'}); }

    async function load() {
      if (!src) { document.getElementById('content').textContent = 'Missing post source (src=…)'; return; }
      try {
        const res = await fetch(src);
        const text = await res.text();
        const m = text.match(/<!--\s*date:\s*([^>]+)\s*-->/i);
        if (m) document.getElementById('meta').textContent = fmtDate(m[1]);
        const md = text.replace(/<!--[^]*?-->/g,''); // strip comments/frontmatter
        document.getElementById('content').innerHTML = marked.parse(md);
        if (!t) {
          const firstH1 = document.querySelector('#content h1');
          if (firstH1) document.getElementById('title').textContent = firstH1.textContent;
        }
      } catch (e) {
        document.getElementById('content').textContent = 'Could not load post: ' + e.message;
      }
    }
    load();
  </script>
</body>
</html>
